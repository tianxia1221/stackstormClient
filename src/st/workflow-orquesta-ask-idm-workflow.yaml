version: 1.0

description: A basic workflow that creates idm roles.

vars:
  - response: null

tasks:
  start:
    action: core.echo message="Automation started."
    next:
      - when: <% succeeded() %>
        do: get_approval

  get_approval:
    action: core.ask
    input:
      schema:
        type: object
        properties:
          approved:
            type: boolean
            description: "Continue?"
            required: True
    next:
      - when: <% succeeded() %>
        do: create_roles1
      - when: <% failed() %>
        do: stop

  create_roles1:
    action: core.http url="http://10.236.114.173:8080/testServlet/role"
    next:
      - when: <% succeeded() %>
        do: create_roles2
      - when: <% failed() %>
        do: stop
         
  create_roles2:
    action: core.http method="POST" url="http://10.236.114.173:8080/testServlet/role" body='{\"name\":\"tina\"}'
    next:
      - when: <% succeeded() %>
        publish: response=<% result().body %>
        do: finish
      - when: <% failed() %>
        do: stop
    
  finish:
    action: core.echo message=<% ctx('response') %>
    
  stop:
    action: core.echo message="Automation stopped."
    next:
      - do: fail
